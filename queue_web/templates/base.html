<!doctype html>
{% load static %}
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="{%static 'css/base.css'%}">
    <title>{% block title %}{% endblock %}</title>
    {% block css %}{% endblock %}
</head>
<body>
<div class="bg-dark fixed-top">
    <nav class="navbar navbar-expand-lg navbar-light navbar-dark bg-dark nav_content">

        <a class="navbar-brand mb-0 h1" href="/">Estra队列系统</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                       data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">语言选择</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">English</a>
                        <a class="dropdown-item" href="#">Chinese</a>
                    </div>
                </li>
            </ul>
            <button type="button" id="btn_login" data-toggle="modal" data-target="#modal_login"
                    class="btn btn-outline-success my-2 my-sm-0 btn-lg btn_sign_up">登陆
            </button>
        </div>

    </nav>
</div>
<!-- Modal -->
<div class="modal fade" id="modal_login" data-backdrop="static"
     tabindex="-1" role="dialog" aria-labelledby="modal_loginLabel"
     aria-hidden="true">

    <div class="modal-dialog modal-dialog-centered">
        <div class="btn_close">
            <button type="button" class="" data-dismiss="modal" aria-label="关闭">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <form class="form-login">
            {% csrf_token %}
            <div align="center" class="shadow-lg bg-white form_block modal-content">

                <div class="bg_title mb-1">
                    <h1 class="h3 font-weight-bolder font-italic display-4">ESTRA</h1>
                </div>
                <h4 class=" mb-4 text-dark font-weight-normal">队列系统</h4>

                <label for="input_name" class="sr-only">Email Name</label>
                <input type="email" id="input_name" class="form-control" placeholder="Email Name" required
                   autofocus value="zonghui.jin">
                <label for="input_pwd" class="sr-only">Password</label>
                <input type="password" id="input_pwd" class="form-control" placeholder="Password" required
                value="123456">
                <div class="text-right text-danger font-weight-normal hidden_tip" id="login_tip">密码错误</div>
                <button type="button" class="btn btn-lg btn-primary btn-block mt-2" id="btn_login_submit">登 陆</button>
                <p class="mt-3 mb-3 text-muted" align="center">&copy; 2020-2100</p>
            </div>
        </form>
    </div>
</div>
<div class="block_content">


{% block content %}
{% endblock%}
</div>
<!-- Optional JavaScript CDN -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->

<script type='text/javascript' src="{% static 'jquery/jquery-3.5.1.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
<script type="text/javascript">
    $('#modal_login').modal();
    var auth = ''
    var rnd = Math.random()
    $('#btn_login_submit').on('click', function(){
        var csrf = $('input[name="csrfmiddlewaretoken"]').val();
        var name = $('#input_name').val();
        var pwd = $('#input_pwd').val();
        $.ajax({
            url:'/login/',
            type:'post',
            cache: 'false',
            data: {name: name, pwd:pwd, csrfmiddlewaretoken:csrf},
            datatype: 'json',
            success: function(data) {
                console.log(data);
                if(data.pass){
                   auth = data.authorization
                   window.location.reload()
                }
                else {
                    console.log($('#login_tip'));
                    $('#login_tip').text(data.error_info);
                    $('#login_tip').css('visibility','visible');


                };
            },
            error:function(e){
                alert('连接异常');
		   },
        });
        return false;
    });
</script>
{% block script %}{% endblock%}
</body>
</html>